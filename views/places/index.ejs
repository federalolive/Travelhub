<%- include('../partials/header') %>

    <body>
        <script
            src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
        <link rel="stylesheet"
            href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css"
            type="text/css" />

        <div id="map"></div>

        <script>
            mapboxgl.accessToken =
                "pk.eyJ1IjoiZmVkZXJhbG9saXZlIiwiYSI6ImNraXE2ZjM0bDFldWgycXBmZHNmczJvbjkifQ.41LdKiQObM-Lk8WvVG6ozg";
            var map = new mapboxgl.Map({
                container: "map",
                style: "mapbox://styles/federalolive/ckiq6lhcn0hve18n6dji0pt75",
                center: [-79.4512, 43.6568],
                zoom: 13,
            });
            
            map.on('load', () => {
            map.on('click', (e) => {
                addMarker(map.unproject(e.point))
            })
        })

        let marker;
        let placeName;
        let popup;

        function addMarker(coords) {
            // We remove the marker and popup if there is already a marker on our map
            if (marker) {
                marker.remove();
                popup.remove();
            }
            // Here we query the Mapbox Geocoder API for a place name, and add our marker and popup to the map once we receive a response
            client.geocodeReverse({ latitude: coords.lat, longitude: coords.lng }, (err, res) => {
                placeName = res.features[0].place_name;
                marker = new mapboxgl.Marker()
                    .setLngLat(coords)
                    .addTo(map);
                popup = new mapboxgl.Popup({ closeButton: false, anchor: 'top' })
                    .setLngLat(coords)
                    .setHTML(`<p>${placeName}</p>`)
                    .addTo(map);
            });
        }
    </script>

            map.addControl(
                new MapboxGeocoder({
                    accessToken: mapboxgl.accessToken,
                    mapboxgl: mapboxgl,
                })
            ); 
            
        </script>

    </body>



    <%- include('../partials/footer') %>